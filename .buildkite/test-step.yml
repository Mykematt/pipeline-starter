steps:
  - label: "ðŸ§ª Test Environment Variable in Uploaded YAML"
    env:
      TEST_QUEUE_VALUE: "my-test-queue"
    command: |
      echo "=== Testing Environment Variable Approach ==="
      echo "TEST_QUEUE_VALUE: $TEST_QUEUE_VALUE"
      echo "BUILDKITE_AGENT_META_DATA_QUEUE: $BUILDKITE_AGENT_META_DATA_QUEUE"
      
      # Create YAML with bash variable substitution (not YAML interpolation)
      cat << EOF > test-step.yml
      steps:
        - label: "ðŸ“‹ Test Step with Queue"
          command: |
            echo "This step should run on my queue"
            echo "Original queue was: $BUILDKITE_AGENT_META_DATA_QUEUE"
          agents:
            queue: "$BUILDKITE_AGENT_META_DATA_QUEUE"
      EOF
      
      echo "=== Generated YAML ==="
      cat test-step.yml
      
      buildkite-agent pipeline upload test-step.yml
    agents:
      queue: "mac"
